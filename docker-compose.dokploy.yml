# =============================================================================
# docker-compose.dokploy.yml
# Configuraci√≥n optimizada para deployment en Dokploy
# No modifica los archivos originales del repositorio
# =============================================================================

version: '3.8'

services:
 webscout-api-production:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - WEBSCOUT_VERSION=latest
    image: webscout-api:latest
    container_name: webscout-api-prod
    restart: unless-stopped
    profiles:
      - production

    environment:
      - WEBSCOUT_HOST=0.0.0.0
      - WEBSCOUT_PORT=8000
      - WEBSCOUT_WORKERS=4  # More workers for production
      - WEBSCOUT_LOG_LEVEL=warning
      - WEBSCOUT_DEBUG=false
      - WEBSCOUT_DATA_DIR=/app/data

      # Authentication settings (production defaults)
      # Note: These may not be fully supported by the server yet
      # Server currently defaults to no authentication

      # Security and performance
      - WEBSCOUT_CORS_ORIGINS=*
      - WEBSCOUT_REQUEST_LOGGING=true

    ports:
      - "${WEBSCOUT_PORT:-8000}:${WEBSCOUT_PORT:-8000}"

    volumes:
      - webscout-logs:/app/logs
      - webscout-data:/app/data

    command: [
      "gunicorn",
      "--bind", "0.0.0.0:${WEBSCOUT_PORT:-8000}",
      "--workers", "4",
      "--worker-class", "uvicorn.workers.UvicornWorker",
      "--log-level", "warning",
      "--access-logfile", "/app/logs/access.log",
      "--error-logfile", "/app/logs/error.log",
      "--preload",
      "webscout.server.server:create_app"
    ]

    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
        reservations:
          memory: 1G
          cpus: '1.0'
